<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

    <link
      href="https://fonts.googleapis.com/css2?family=Quicksand&display=swap"
      rel="stylesheet"
    />

    <link
      href="https://fonts.googleapis.com/css2?family=Dancing+Script&family=Quicksand&display=swap"
      rel="stylesheet"
    />
    <!-- Google Fonts -->
    <link rel="stylesheet" href="CSS files/googleFont.css" />
    <link rel="stylesheet" href="CSS files/best_sell.css" />
    <link rel="stylesheet" href="CSS files/new_arrivals.css" />
    <link rel="stylesheet" href="CSS files/Product_Page.css" />
    <link rel="stylesheet" href="CSS files/header.css" />
    <link rel="stylesheet" href="CSS files/cart.css" />
    <link rel="stylesheet" href="CSS files/loginForm.css" />
  </head>
  <body>
    <!-- header -->
    <div class="header_containor">
      <div id="header-placeholder"></div>
    </div>
    <!-- header -->

    <div class="product_detail_container">
      <div class="product_image_container">
        <div class="product_image">
          <img src="" alt="" />
        </div>
        <!-- <div class="other_images">
          <img class="firdt_img" src="" alt="" />
          <img class="second_img" src="" alt="" />
        </div> -->
      </div>
      <div class="product_detail">
        <div class="name_assurance_container">
          <div class="product_name">Product Name</div>
        </div>
        <div class="rating"></div>
        <div class="product_description">Product Description</div>

        <div class="weight_container">
          <div class="weight">Weight</div>
        </div>

        <div class="quantity_container">
          <div class="quantity">Quantity</div>
          <span class="qty_descrese" onclick="decreaseQuantity()">-</span>
          <span class="qty_number">1</span>
          <span class="qty_increse" onclick="increaseQuantity()">+</span>
        </div>

        <div class="product_price_container">
          <div class="price_heading">Price</div>
          <div class="priceSign">â‚¹</div>
        </div>

        <div class="buy_cart_container">
          <a class="buy_button" href="paymentPage.html"> BUY </a>
          <div class="add_to_cart_button">ADD TO CART</div>
        </div>
      </div>
    </div>

    <!-- Best Sellers Dynamically -->
    <div class="best_sell_container">
      <div class="best_sell_heading">
        <h1>Our Best Selling Products</h1>
      </div>
      <div class="best_sell_products">
        <ul id="bestSellerList"></ul>
      </div>
    </div>
    <!-- Best Sellers Dynamically -->

    <div class="description_review_policy_container">
      <div class="desc_shipping_review">
        <div
          class="description"
          onclick="changeColorsClickDescriptionShipping(this)"
          onmouseover="changeColorsDescriptionShipping(this)"
          onmouseout="restoreOriginalColorsDescriptionShipping(this)"
        >
          Description
        </div>
        <div
          class="shipping_Returns"
          onclick="changeColorsClickDescriptionShipping(this)"
          onmouseover="changeColorsDescriptionShipping(this)"
          onmouseout="restoreOriginalColorsDescriptionShipping(this)"
        >
          Shipping & Returns
        </div>
        <div class="reviews" onclick="scrollToReview()">Reviews</div>
      </div>
      <div class="product_description_container">
        <div class="product_description">
          <div class="desc_product_name">
            Product Name :
            <span class="DescriptionProductName">Product Name</span>
          </div>
        </div>
        <div class="keyIngredientsContainer">
          <div class="keyIngredients">Key Ingredients :</div>
          <div class="keyIngredientsList"></div>
        </div>
        <div class="featuresContainer">
          <div class="features">Features :</div>
          <div class="featuresList"></div>
        </div>

        <div class="howToUseContainer">
          <div class="howToUse">How To Use :</div>
          <div class="howToUseList"></div>
        </div>
        <div class="cautionContainer">
          <div class="caution">Caution :</div>
          <div class="cautionList"></div>
        </div>
      </div>
      <div class="shipping_Returns_container">
        <div class="returnPolicy_container">
          <div class="returnPolicy">RETURN POLICY</div>
          <p class="returnPolicy_detail">
            Welcome to BotanicBlend, where customer satisfaction is our
            priority. <br /><br />
            Our skincare product return policy is designed to ensure a seamless
            and transparent process for our valued customers. Eligible products
            for return must be unused, unopened, and in their original
            packaging, with returns accepted within 3 days from the date of
            purchase.
            <br />
            Initiating a return is easy; simply initiate the return through your
            customer account For a smooth return process, a return authorization
            is required, and you can obtain it by contacting our customer
            support.
            <br />
            Returned products must meet the criteria of being in their original
            condition.
            <br />
            Regarding return shipping, the customer or is responsible for return
            shipping.
            <br />
            Refunds are typically processed within 15 days of receiving the
            returned product and will be issued via credit card refund.
            <br />
            Be sure to review any exceptions to our return policy, such as
            specific sale items or promotional products. In the rare event of
            receiving a damaged or defective product, please contact our
            customer support immediately, and include photos of the product for
            verification. <br /><br />
            Thank you for choosing BotanicBlend for your skincare needs.
          </p>
        </div>
        <br /><br />
        <div class="shippingDetail_container">
          <div class="shippingDetail">SHIPPING DETAIL</div>
          <p class="shippingDetail_detial">
            We can ship to vitually any address in the world. Note that there
            Are restriction on some products, and some products cannot be
            Shipped to international destination.
            <br /><br />
            When you place an order, we Will estimate shipping and delivery
            dates for you based on the Availabilty of your item and the shipping
            options you choose. Depending on the shipping provider you choose,
            shipping dates Estimates may appear on the shipping quotes page.
            <br /><br />
            Please also note That the shipping rates for many items we sell are
            wieght-based. The Wieght of any such item can be found on its detail
            page. To reflect The policies of the shipping companies we use, all
            weights will be Rounded up to the next full pound.
          </p>
        </div>
      </div>
      <div class="customer_reviews_container">
        <div class="customerReviewHeading">
          <div class="heading">Customer Reviews</div>
          <span class="writeReview">Write a review</span>
        </div>
        <div class="review_write_container">
          <div class="review_write_container_heading">Write a review</div>
          <form id="reviewForm" class="ReviewFrom">
            <div class="rating_container">
              <div class="review_rating">
                <div
                  class="star_container"
                  onmousemove="updateStars(1)"
                  onmouseleave="resetStars()"
                  onclick="setRating(1)"
                >
                  <img
                    src="Photos/Stars/unactive-star.png"
                    alt="Star"
                    class="star"
                    id="star1"
                  />
                </div>
                <div
                  class="star_container"
                  onmousemove="updateStars(2)"
                  onmouseleave="resetStars()"
                  onclick="setRating(2)"
                >
                  <img
                    src="Photos/Stars/unactive-star.png"
                    alt="Star"
                    class="star"
                    id="star2"
                  />
                </div>
                <div
                  class="star_container"
                  onmousemove="updateStars(3)"
                  onmouseleave="resetStars()"
                  onclick="setRating(3)"
                >
                  <img
                    src="Photos/Stars/unactive-star.png"
                    alt="Star"
                    class="star"
                    id="star3"
                  />
                </div>
                <div
                  class="star_container"
                  onmousemove="updateStars(4)"
                  onmouseleave="resetStars()"
                  onclick="setRating(4)"
                >
                  <img
                    src="Photos/Stars/unactive-star.png"
                    alt="Star"
                    class="star"
                    id="star4"
                  />
                </div>
                <div
                  class="star_container"
                  onmousemove="updateStars(5)"
                  onmouseleave="resetStars()"
                  onclick="setRating(5)"
                >
                  <img
                    src="Photos/Stars/unactive-star.png"
                    alt="Star"
                    class="star"
                    id="star5"
                  />
                </div>
              </div>
            </div>

            <div class="review_title_container">
              <div class="review_title">Review Title</div>
              <input
                type="text"
                id="reviewTitle"
                name="reviewTitle"
                placeholder="Give your review a title"
              />
            </div>
            <div class="review_body_container">
              <div class="review_body">Body of review (1500)</div>
              <textarea
                name="reviewBody"
                id="reviewBody"
                cols="30"
                rows="10"
                placeholder="Write your review here..."
              ></textarea>
            </div>
            <div class="submit_button">
              <input
                type="submit"
                value="Submit Review"
                id="ReviewSubmitButton"
              />
            </div>
          </form>
        </div>

        <div class="review_container" id="reviewContainer">
          <ul class="review_list" id="reviewList">
            <li>
              <div class="customerName_date_container">
                <div class="customer_name">Name</div>
                <span>on</span>
                <div class="date">Date</div>
              </div>
              <div class="customerRating"></div>
              <div class="review_title">Review Title</div>
              <div class="review_body">Review Body</div>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer_container">
      <div id="footer-placeholder"></div>
    </div>
    <!-- Footer -->
    <script src="JavaScript files/NavbarFooterLoader.js"></script>
    <script src="JavaScript files/cart.js"></script>
    <script src="JavaScript files/loginFormShow.js"></script>
    <script src="JavaScript files/singIn.js"></script>
    <script src="JavaScript files/addToCart.js"></script>
    <script src="JavaScript files/button_color_change.js"></script>
    <script src="JavaScript files/cart_icon_change.js"></script>

    <script src="JavaScript files/productPage_descriptionOrShipping_hide_show.js"></script>
    <script src="JavaScript files/productPage_reviewScroll.js"></script>
    <script src="JavaScript files/productPage_reviewWrite_HideShow.js"></script>
    <script src="JavaScript files/ReviewStar.js"></script>

    <script>
      // products fetching
      document.addEventListener("DOMContentLoaded", function () {
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const product_Name = urlParams.get("productName");

        fetch(`/productDetails?productName=${product_Name}`)
          .then((response) => response.json())
          .then((productDetails) => {
            document.querySelector(".product_image img").src =
              productDetails[0].image_url.replace("other pages/", "");

            document.querySelector(".product_name").innerText =
              productDetails[0].name;

            const ratingContainer = document.querySelector(".rating");
            for (let i = 0; i < productDetails[0].rating; i++) {
              const starImage = document.createElement("img");
              starImage.src = "Photos/Stars/active-star.png";
              starImage.alt = "Product_Star";
              starImage.className = "Product_star";
              starImage.id = "Product_star" + (i + 1);
              ratingContainer.appendChild(starImage);
            }

            document.querySelector(".product_description").innerText =
              productDetails[0].description;
            const weightContainer = document.querySelector(".weight_container");
            for (let i = 0; i < productDetails.length; i++) {
              const weightSpan = document.createElement("span");
              weightSpan.innerText = productDetails[i].size;
              weightSpan.setAttribute(
                "onmouseover",
                "changeColorsWeight(this)"
              );
              weightSpan.setAttribute(
                "onclick",
                `changeColorsClickWeight(this); weightSelector(this, ${JSON.stringify(
                  productDetails
                )})`
              );
              weightSpan.setAttribute(
                "onmouseout",
                "restoreOriginalColorsWeight(this)"
              );
              weightSpan.setAttribute("id", `weight${i + 1}`);
              weightContainer.appendChild(weightSpan);
              changeColorsClickWeight(document.getElementById("weight1"));
            }

            const priceContainer = document.querySelector(
              ".product_price_container"
            );
            for (let i = 0; i < productDetails.length; i++) {
              const priceDiv = document.createElement("div");
              priceDiv.innerHTML = productDetails[i].price;
              priceDiv.setAttribute("class", "productPrice");
              priceDiv.setAttribute("id", `price${i + 1}`);
              priceContainer.appendChild(priceDiv);

              if (i > 0) {
                priceDiv.style.display = "none";
              } else {
                priceDiv.style.display = "block";
                originalPrice = priceDiv.innerText;
                newPrice = document.getElementById("price1");
                updateQtyAndPrice();
              }
            }

            document.querySelector(".add_to_cart_button").onclick =
              function () {
                addToCart(product_Name);
              };

            document.querySelector(".DescriptionProductName").innerText =
              productDetails[0].name;
            document.querySelector(".keyIngredientsList").innerHTML =
              productDetails[0].KeyIngredients;
            document.querySelector(".featuresList").innerHTML =
              productDetails[0].Features;
            document.querySelector(".howToUseList").innerHTML =
              productDetails[0].HowToUse;
            document.querySelector(".cautionList").innerHTML =
              productDetails[0].Caution;
          })
          .catch((error) =>
            console.error("Error fetching product details:", error)
          );
      });
    </script>

    <script src="JavaScript files/Qty_selector.js"></script>

    <script>
      //BEST SELLERS PRODUCTS

      fetch("/Best_Sellers")
        .then((response) => response.json())
        .then((data) => {
          renderBestSellers(data);
        })
        .catch((error) => console.error("Error fetching data:", error));

      function renderBestSellers(data) {
        const bestSellerList = document.getElementById("bestSellerList");

        data.forEach((product) => {
          const listItem = document.createElement("li");
          var modifiedImagePath = product.image_url.replace("other pages/", "");

          var buyProduct = [];
          var buy_product = {
            img: modifiedImagePath,
            name: product.name,
            price: parseInt(product.price, 10),
            quantity: 1,
            rating: product.rating,
            weight: product.size,
          };

          buyProduct.push(buy_product);
          listItem.innerHTML = `
                      <div class="best_sell_product_section">
                        <div class="best_sell_product_image">
                            <a href="Product_Page.html?productName=${
                              product.name
                            }&price=${parseInt(product.price, 10)}&img=${
            product.image_url
          }&rating=${
            product.rating
          }"><img src="${modifiedImagePath}" alt="" /></a>

                          </div>
                          <div class="best_sell_product_name">${
                            product.name
                          }</div>
                          <div class="best_sell_product_rating">${generateStarsForReviewSection(
                            product.rating
                          )}</div>
                          <div class="best_sell_product_price">
                              <div class="price">${product.price}</div>
                              <!-- Add to Cart section -->
                              <div class="add_to_cart product-container"
                                  onmouseover="showAddToCart(this) ; changeColors(this)"
                                  onmouseout="hideAddToCart(this)">
                                  <div class="icon">
                                       <svg
                                          xmlns="http://www.w3.org/2000/svg"
                                          height="16"
                                          width="15"
                                          viewBox="0 0 576 512"
                                          >
                                          <!--!Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2023 Fonticons, Inc.-->
                                          <path
                                              d="M0 24C0 10.7 10.7 0 24 0H69.5c22 0 41.5 12.8 50.6 32h411c26.3 0 45.5 25 38.6 50.4l-41 152.3c-8.5 31.4-37 53.3-69.5 53.3H170.7l5.4 28.5c2.2 11.3 12.1 19.5 23.6 19.5H488c13.3 0 24 10.7 24 24s-10.7 24-24 24H199.7c-34.6 0-64.3-24.6-70.7-58.5L77.4 54.5c-.7-3.8-4-6.5-7.9-6.5H24C10.7 48 0 37.3 0 24zM128 464a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm336-48a48 48 0 1 1 0 96 48 48 0 1 1 0-96z"
                                          />
                                      </svg>
                                  </div>
                                  <div class="add-to-cart" onclick='addToCart("${
                                    product.name
                                  }")'>Add to Cart</div>
                              </div>
                          </div>
                          <!-- Buy button -->
                          <a href="paymentPage.html?product=${encodeURIComponent(
                            JSON.stringify(buyProduct)
                          )}"><div class="new_arrival_product_buttons btn_color"
                              onmouseover="changeColors(this)">
                              Buy
                          </div></a>
                      </div>
                  `;

          bestSellerList.appendChild(listItem);
        });
      }

      // Function to submit a review
      const query_String = window.location.search;
      const url_Params = new URLSearchParams(query_String);
      const productName = url_Params.get("productName");

      function submitReview(event) {
        event.preventDefault();

        const rating = getSelectedRating();
        const title = document.getElementById("reviewTitle").value;
        const body = document.getElementById("reviewBody").value;

        fetch("/checkAuth")
          .then((response) => response.json())
          .then((data) => {
            if (data.isAuthenticated) {
              const reviewData = { rating, title, body, productName };
              submitReviewToServer(reviewData);
            } else {
              alert("You must log in before submitting a review.");
            }
          })
          .catch((error) => {
            console.error("Error checking authentication:", error);
          });
      }

      // Function to submit the review data to the server
      function submitReviewToServer(reviewData) {
        fetch("/submitReview", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(reviewData),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              updateReviewList(productName);
              document.getElementById("reviewTitle").value = "";
              document.getElementById("reviewBody").value = "";
              selectedRating = 0;
              resetStars();
              const review_Button = document.querySelector(".writeReview");
              reviewContainer.style.display = "none";
              reviewClicked = false;
              review_Button.textContent = "Write a review";
            } else {
              alert("Failed to submit the review. Please try again later.");
            }
          })
          .catch((error) => {
            console.error("Error submitting review:", error);
          });
      }

      // Function to update the review list from the server
      function updateReviewList(productName) {
        fetch(`/getReviews?productName=${productName}`, {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        })
          .then((response) => response.json())
          .then((data) => {
            const reviews = data.reviews;

            const reviewList = document.getElementById("reviewList");
            reviewList.innerHTML = "";

            reviews.forEach((review) => {
              const formattedDate = new Date(
                review.created_at
              ).toLocaleString();

              const listItem = document.createElement("li");

              if (data.sessionId && data.sessionId == review.user_id) {
                console.log(`user log in ${data.sessionId}`);

                listItem.innerHTML = `
                    <div class="customerName_date_container">
                      <div class="customerName_date_container_left">
                        <div class="customer_name">${review.user_name}</div>
                        <span>on</span>
                        <div class="date">${formattedDate}</div>
                      </div>
                      <div class="customerName_date_container_right">
                        <button class="delete-review" data-review-id="${
                          review.reviewId
                        }">
                          Delete Review
                        </button>
                      </div>
                    </div>
                    <div class="CustomerRating">${generateStarsForReviewSection(
                      review.user_rating
                    )}</div>
                    <div class="review_title">${review.title}</div>
                    <div class="review_body">${review.body}</div>
                  `;
              } else {
                listItem.innerHTML = `
                    <div class="customerName_date_container">
                      <div class="customerName_date_container_left">
                        <div class="customer_name">${review.user_name}</div>
                        <span>on</span>
                        <div class="date">${formattedDate}</div>
                      </div>
                      <div class="customerName_date_container_right">
                        
                      </div>
                    </div>
                    <div class="CustomerRating">${generateStarsForReviewSection(
                      review.user_rating
                    )}</div>
                    <div class="review_title">${review.title}</div>
                    <div class="review_body">${review.body}</div>
                  `;
              }
              reviewList.appendChild(listItem);
            });
            const deleteButtons = document.querySelectorAll(".delete-review");
            deleteButtons.forEach((button) => {
              button.addEventListener("click", (event) => {
                const reviewId = event.target.getAttribute("data-review-id");
                deleteReview(reviewId);
              });
            });
          })
          .catch((error) => {
            console.error("Error updating review list:", error);
          });
      }

      function deleteReview(reviewId) {
        fetch(`/deleteReview/${reviewId}`, {
          method: "DELETE",
          headers: {
            "Content-Type": "application/json",
          },
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              updateReviewList(productName);
            } else {
              console.log(data.message);
            }
          })
          .catch((error) => {
            console.error("Error deleting review:", error);
          });
      }

      // Function to generate star icons based on the rating
      function generateStarsForReviewSection(rating) {
        const maxStars = 5;

        const starHtml = Array.from({ length: rating }, () => {
          return `<img class="CustomerReviesStars" src="Photos/Stars/active-star.png" alt="" />`;
        });

        return starHtml.join("");
      }

      // Function to get the selected rating
      function getSelectedRating() {
        return selectedRating;
      }

      // Attach the submitReview function to the form submission
      document
        .getElementById("reviewForm")
        .addEventListener("submit", submitReview);

      updateReviewList(productName);
    </script>
  </body>
</html>
