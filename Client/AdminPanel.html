<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Panel</title>
    <style>
      /* CSS styles */
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
      }

      #sidebar {
        position: fixed;
        left: 0;
        top: 5rem;
        width: 200px;
        height: 100%;
        background-color: #333;
        color: #fff;
        padding-top: 20px;
      }

      #sidebar ul {
        list-style-type: none;
        padding: 0;
      }

      #sidebar ul li {
        padding: 10px;
        cursor: pointer;
      }

      #content {
        margin-left: 200px;
        padding: 20px;
      }

      /* Hide content initially */
      .section {
        display: none;
      }

      /* Show content based on active section */
      .active {
        display: block;
      }
      .header {
        background-color: #333;
        display: flex;
        justify-content: space-between;
        position: sticky;
        top: 0;
      }
      .logoImg img {
        width: 5rem;
        height: 5rem;
      }
      .logOutButton {
        color: white;
        padding: 2rem;
        display: flex;
        align-items: center;
        cursor: pointer;
      }
      .deletProdcut {
        cursor: pointer;
      }
    </style>
    <link rel="stylesheet" href="other pages/CSS files/best_sell.css" />
    <link rel="stylesheet" href="other pages/CSS files/new_arrivals.css" />
    <link
      rel="stylesheet"
      href="other pages/CSS files/Multiple_Products_Page.css"
    />
  </head>
  <body>
    <div class="header">
      <div class="logoImg">
        <img src="other pages/Photos/Header Image/BB_Logo.png" alt="" />
      </div>
      <div class="logOutButton">Log Out</div>
    </div>
    <!-- Sidebar -->
    <div id="sidebar">
      <ul>
        <li onclick="showSection('dashboard')">Dashboard</li>
        <li onclick="showSection('products')">Products</li>
        <li onclick="showSection('customers')">Customers</li>
        <li onclick="showSection('settings')">Settings</li>
      </ul>
    </div>

    <!-- Content -->
    <div id="content">
      <!-- Dashboard Section -->
      <div id="dashboard" class="section active">
        <h2>Dashboard</h2>
        <div class="noOfPurchase">
          Total Purchases :
          <span id="NoOfPurchase"> </span>
        </div>
        <div class="noOfUsers">
          Total Users :
          <span id="NoOfUsers"> </span>
        </div>
        <div class="noOfProducts">
          Total Products :
          <span id="NoOfProducts"> </span>
        </div>

        <!-- Best Sellers Dynamically -->
        <div class="best_sell_container">
          <div class="best_sell_heading">
            <h1>Our Best Selling Products</h1>
          </div>
          <div class="best_sell_products">
            <ul id="bestSellerList"></ul>
          </div>
        </div>
        <!-- Best Sellers Dynamically -->
        <div class="feedback_container"></div>
      </div>

      <!-- Products Section -->
      <div id="products" class="section">
        <div class="addNewProduct">Add New Product</div>
        <div class="container">
          <h2>Add New Product</h2>
          <form id="product-form" enctype="multipart/form-data">
            <!-- Add enctype attribute for file upload -->
            <div class="form-group">
              <label for="name">Product Name:</label>
              <input type="text" id="name" name="name" required />
            </div>
            <div class="form-group">
              <label for="description">Description:</label>
              <textarea
                id="description"
                name="description"
                rows="4"
                required
              ></textarea>
            </div>
            <div class="form-group">
              <label for="category">Category:</label>
              <select id="category" name="category" required>
                <option value="">Select Category</option>
                <option value="gels">Gels</option>
                <option value="creams">Creams</option>
                <option value="bodyCare">Body Care</option>
                <option value="bathing">Bathing</option>
              </select>
            </div>
            <div class="form-group">
              <label for="image">Image:</label>
              <!-- Change input type to file -->
              <input
                type="file"
                id="image"
                name="image"
                accept="image/*"
                required
              />
              <!-- Add accept attribute to specify image files -->
            </div>
            <div class="form-group">
              <label for="rating">Rating:</label>
              <input
                type="number"
                id="rating"
                name="rating"
                min="1"
                max="5"
                required
              />
            </div>
            <div class="form-group">
              <label for="best_seller">Best Seller:</label>
              <input type="checkbox" id="best_seller" name="best_seller" />
            </div>
            <div id="variations-group">
              <label>Variations:</label>
              <div id="variation-inputs">
                <div class="variation-input">
                  <input
                    type="text"
                    name="size[]"
                    placeholder="Size"
                    required
                  />
                  <input
                    type="number"
                    name="price[]"
                    placeholder="Price"
                    min="0"
                    step="0.01"
                    required
                  />
                  <input
                    type="number"
                    name="stock_quantity[]"
                    placeholder="Stock Quantity"
                    min="0"
                    required
                  />
                </div>
              </div>
              <button type="button" id="add-variation-btn">
                Add Variation
              </button>
            </div>
            <button type="submit">Add Product</button>
          </form>
        </div>
        <h2>Products</h2>
        <ul id="ProductsListCotainer"></ul>
      </div>

      <!-- Customers Section -->
      <div id="customers" class="section">
        <h2>Customers</h2>
        <select onchange="showCustomerOption(this.value)">
          <option value="view">View Customers</option>
          <option value="delete">Delete Customer</option>
        </select>
        <div id="customerOptions"></div>
      </div>

      <!-- Settings Section -->
      <div id="settings" class="section">
        <h2>Settings</h2>
        <p>Modify Admin Settings here.</p>
      </div>
    </div>

    <script>
      function showSection(section) {
        const dashboard = document.getElementById("dashboard");
        const products = document.getElementById("products");
        const customers = document.getElementById("customers");
        const settings = document.getElementById("settings");

        if (section === "dashboard") {
          dashboard.style.display = "block";
          products.style.display = "none";
          customers.style.display = "none";
          settings.style.display = "none";
        } else if (section === "products") {
          dashboard.style.display = "none";
          products.style.display = "block";
          customers.style.display = "none";
          settings.style.display = "none";
        } else if (section === "customers") {
          dashboard.style.display = "none";
          products.style.display = "none";
          customers.style.display = "block";
          settings.style.display = "none";
        } else if (section === "settings") {
          dashboard.style.display = "none";
          products.style.display = "none";
          customers.style.display = "none";
          settings.style.display = "block";
        }
      }

      //   // Function to show selected section
      //   function showSection(section) {
      //     // Hide all sections
      //     var sections = document.getElementsByClassName("section");
      //     for (var i = 0; i < sections.length; i++) {
      //       sections[i].classList.remove("active");
      //     }

      //     // Show selected section
      //     document.getElementById(section).classList.add("active");
      //   }

      //   // Function to show product options
      function showProductOption(option) {
        var productOptionsDiv = document.getElementById("productOptions");
        productOptionsDiv.innerHTML = "";

        if (option === "view") {
          productOptionsDiv.innerHTML = "<p>Show Product List here.</p>";
        } else if (option === "add") {
          productOptionsDiv.innerHTML = "<p>Show Add Product form here.</p>";
        } else if (option === "delete") {
          productOptionsDiv.innerHTML =
            "<p>Show Delete Product option here.</p>";
        }
      }

      //   // Function to show customer options
      //   function showCustomerOption(option) {
      //     var customerOptionsDiv = document.getElementById("customerOptions");
      //     customerOptionsDiv.innerHTML = "";

      //     if (option === "view") {
      //       customerOptionsDiv.innerHTML = "<p>Show Customer List here.</p>";
      //     } else if (option === "delete") {
      //       customerOptionsDiv.innerHTML =
      //         "<p>Show Delete Customer option here.</p>";
      //     }
      //   }

      // no. of purchase
      async function PurchaseCount() {
        try {
          const response = await fetch("/NumberOfPurchase");
          const data = await response.json();

          if (data.success) {
            const purchaseCount = data.purchaseCount;
            document.getElementById("NoOfPurchase").textContent = purchaseCount;
          } else {
            console.error("Failed to retrieve purchase count");
          }
        } catch (error) {
          console.error("Error fetching purchase count:", error);
        }
      }
      // Call the function to update the purchase count when the page loads
      PurchaseCount();

      // no. of Users
      async function UsersCount() {
        try {
          const response = await fetch("/NumberOfUsers");
          const data = await response.json();

          if (data.success) {
            const UserCount = data.userCount;
            document.getElementById("NoOfUsers").textContent = UserCount;
          } else {
            console.error("Failed to retrieve Users count");
          }
        } catch (error) {
          console.error("Error fetching Users count:", error);
        }
      }
      // Call the function to update the purchase count when the page loads
      UsersCount();

      // no. of products
      async function productsCount() {
        try {
          const response = await fetch("/TotalProducts");
          const data = await response.json();

          if (data.success) {
            const ProductCount = data.ProductCount;
            document.getElementById("NoOfProducts").textContent = ProductCount;
          } else {
            console.error("Failed to retrieve products count");
          }
        } catch (error) {
          console.error("Error fetching products count:", error);
        }
      }
      // Call the function to update the purchase count when the page loads
      productsCount();

      // Function to fetch feedback from server and display it
      async function displayFeedback() {
        try {
          const response = await fetch("/GetAllFeedback");
          const data = await response.json();

          if (data.success) {
            const feedbackRows = data.rows;
            const feedbackContainer = document.querySelector(
              ".feedback_container"
            );

            // Clear previous feedback
            feedbackContainer.innerHTML = "";

            // Loop through each feedback entry and create HTML elements to display them
            feedbackRows.forEach((feedback) => {
              const feedbackElement = document.createElement("div");
              feedbackElement.classList.add("feedback");

              const name = document.createElement("p");
              name.textContent = `Name: ${feedback.name}`;

              const email = document.createElement("p");
              email.textContent = `Email: ${feedback.email}`;

              const phoneNumber = document.createElement("p");
              phoneNumber.textContent = `Phone Number: ${feedback.phone_number}`;

              const comment = document.createElement("p");
              comment.textContent = `Comment: ${feedback.comment}`;

              const createdAt = document.createElement("p");
              const dateOptions = {
                year: "numeric",
                month: "numeric",
                day: "numeric",
                hour: "numeric",
                minute: "numeric",
                second: "numeric",
                timeZone: "Asia/Kolkata", // Indian Standard Time
              };
              createdAt.textContent = `Created At: ${new Date(
                feedback.created_at
              ).toLocaleString("en-IN", dateOptions)}`;

              feedbackElement.appendChild(name);
              feedbackElement.appendChild(email);
              feedbackElement.appendChild(phoneNumber);
              feedbackElement.appendChild(comment);
              feedbackElement.appendChild(createdAt);

              feedbackContainer.appendChild(feedbackElement);
            });
          } else {
            console.error("Failed to retrieve feedback");
          }
        } catch (error) {
          console.error("Error fetching feedback:", error);
        }
      }
      // Call the function to display feedback when the page loads
      displayFeedback();

      //BEST SELLERS PRODUCTS
      fetch("/Best_Sellers")
        .then((response) => response.json())
        .then((data) => {
          renderBestSellers(data);
        })
        .catch((error) => console.error("Error fetching data:", error));

      function renderBestSellers(data) {
        const bestSellerList = document.getElementById("bestSellerList");
        data.forEach((product) => {
          var buyProduct = [];
          var buy_product = {
            img: product.image_url.replace("other pages/", ""),
            name: product.name,
            price: parseInt(product.price, 10),
            quantity: 1,
            rating: product.rating,
            weight: product.size,
          };
          buyProduct.push(buy_product);
          const listItem = document.createElement("li");
          listItem.innerHTML = `
                      <div class="best_sell_product_section">
                        <div class="best_sell_product_image">

                            <img src="${product.image_url}"  alt="" />

                          </div>
                          <div class="best_sell_product_name">${
                            product.name
                          }</div>
                          <div class="best_sell_product_rating">${generateStarsForIndexPage(
                            product.rating
                          )}</div>
                          <div class="best_sell_product_price">
                              <div class="price">Price : ${parseInt(
                                product.price,
                                10
                              )}</div>
                              <!-- Add to Cart section -->

                          </div>


                      </div>
                  `;
          bestSellerList.appendChild(listItem);
        });
      }
      function generateStarsForIndexPage(rating) {
        const starHtml = Array.from({ length: rating }, () => {
          return `<img class="IndexPageStars" src="other pages/Photos/Stars/active-star.png" alt="" />`;
        });
        return starHtml.join("");
      }

      function AllProducts() {
        // Fetch the list of products from the server
        fetch("/getAllProducts")
          .then((response) => response.json())
          .then((data) => {
            console.log("get data");
            // Call a function to render the products on the multipleProducts.html page
            renderProducts(data);
          })
          .catch((error) => console.error("Error fetching products:", error));
      }
      function renderProducts(data) {
        console.log("fetching");
        const productsCount = document.querySelector(".ProductsCount");
        // Get the UL element
        const productsListContainer = document.getElementById(
          "ProductsListCotainer"
        );

        // Clear existing products
        productsListContainer.innerHTML = "";

        // Loop through the data and create list items
        data.forEach((product) => {
          var buyProduct = [];
          var buy_product = {
            img: product.image_url.replace("other pages/", ""),
            name: product.name,
            price: parseInt(product.price, 10),
            quantity: 1,
            rating: product.rating,
            weight: product.size,
          };
          buyProduct.push(buy_product);
          const listItem = document.createElement("li");
          let newImgUrl = product.image_url.replace(
            "other pages/",
            "other pages/"
          );

          listItem.innerHTML = `
      <div class="product_container">
        <div class="product_image">
          <a href="Product_Page.html?productName=${product.name}&price=${
            product.price
          }&img=${newImgUrl}&rating=${product.rating}">
            <img src="${newImgUrl}" alt="" loading="lazy" />
          </a>
        </div>
        <div class="product_name">${product.name}</div>
        
        <div class="product_rating">${generateStarsForMultiplePage(
          product.rating
        )}</div>
        <div class="product_price">Price : 
          ${parseInt(product.price)}
        <div class="deletProdcut" onclick="deleteProduct('${
          product.name
        }')">Delete</div>               
      </div>
    `;

          // Append the list item to the UL
          productsListContainer.appendChild(listItem);
        });
      }

      function generateStarsForMultiplePage(rating) {
        const starHtml = Array.from({ length: rating }, () => {
          return `<img class="MultiplePageReviesStars" src="other pages/Photos/Stars/active-star.png" alt="" />`;
        });
        return starHtml.join("");
      }
      AllProducts();

      function deleteProduct(productName) {
        if (confirm(`Are you sure you want to delete ${productName}?`)) {
          // Execute AJAX request to delete the product
          fetch("/deleteProduct", {
            method: "DELETE",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({ name: productName }),
          })
            .then((response) => {
              if (response.ok) {
                // Product deleted successfully
                console.log(`Product ${productName} deleted successfully.`);
                // Optionally, update the UI to reflect the deletion
              } else {
                // Error occurred while deleting the product
                console.error(
                  `Error deleting product ${productName}: ${response.statusText}`
                );
              }
            })
            .catch((error) => {
              console.error(
                `Error deleting product ${productName}: ${error.message}`
              );
            });
        }
      }
    </script>
  </body>
</html>
